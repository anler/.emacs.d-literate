* Table of contents                                                     :TOC:
* Eshell (Elisp Shell)

| M-r     |         | Search backwards for a command by regexp.      |
| M-s     |         | Search forwards for a command by regexp.       |
| M-p     |         | Previous command in history.                   |
| M-n     |         | Next command in history.                       |
| C-c C-p |         | Jump to previous command.                      |
| C-c C-n |         | Jump to next command.                          |
| C-c M-r |         | Jump to previous instances of current command. |
| C-c M-s |         | Jump to next instances of current command.     |
| C-c M-b |         | Insert printed buffer name at point.           |
| C-c M-i |         | Insert printed process name at point.          |
| C-c M-v |         | Insert and environment variable at point.      |
| C-c M-d |         | Toggle between direct/delayed input.           |
History Interaction  
| !!       |   | Repeat last command.                                |
| !ls      |   | Repeat last command beginning with ls.              |
| !?ls     |   | Repeat last command containing ls.                  |
| !ls:n    |   | Extrat nth arg from last command beginning with ls. |
| !ls      |   | Show completion results matches ls.                 |
| ^old^new |   | Replace old with new in last command and run it.    |
| $_       |   | Returns last parameter in last command.             |

** Config inside Emacs
:PROPERTIES:
:tangle:   ~/.emacs.d/shells.el
:END:
#+BEGIN_SRC elisp
  (require 'eshell)
  (require 'em-smart)
  (setq eshell-where-to-jump 'begin
        eshell-review-quick-commands nil
        eshell-smart-space-goes-to-end t)
#+END_SRC
** Config outside Emacs
:PROPERTIES:
:tangle: ~/.eshell/profile
:mkdirp: t
:END:
#+BEGIN_SRC sh
  ## -*- mode: eshell-script -*-
  (setenv "PAGER" "cat")
  (setenv "TERM" "xterm-256color")

  (setq eshell-ask-to-save-history 'always)
#+END_SRC

* Shell
/output group/ consists of a command and its output.

| C-c C-c |                            | Terminate command.                       |
| C-c C-z |                            | Stop a job.                              |
| C-c C-o | comint-kill-output         | Get rid of the prev command output.      |
| C-c C-r | comint-show-output         | Show the top of the prev command output. |
| C-c C-e | comint-show-maximum-output | Same as above but show the end instead.  |
| C-c C-p |                            | Previous output group.                   |
| C-c C-n |                            | Next output group.                       |
| M-p     | comint-previous-input      | Previous command.                        |
| M-n     | comint-next-input          | Next command.                            |

** Config inside Emacs
:PROPERTIES:
:tangle: ~/.emacs.d/shells.el.el
:END:

Set shell:
#+BEGIN_SRC elisp
  (setq shell-file-name "/bin/zsh")
#+END_SRC

Making passwords invisible:
#+BEGIN_SRC elisp
  (add-hook 'comint-output-filter-functions
            'comint-watch-for-password-prompt)
#+END_SRC

#+BEGIN_SRC elisp
  (add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)
#+END_SRC

#+BEGIN_SRC elisp
  (add-hook 'shell-mode-hook (lambda ()
                               (yas-minor-mode -1)
                               (whitespace-mode -1)
                               (smartparens-mode -1)))
#+END_SRC

Bash Completion:
#+BEGIN_SRC elisp
  (autoload 'bash-completion-dynamic-complete 
    "bash-completion"
    "BASH completion hook")
  (add-hook 'shell-dynamic-complete-functions
    'bash-completion-dynamic-complete)
  (add-hook 'shell-command-complete-functions
    'bash-completion-dynamic-complete)
#+END_SRC

** Config outside Emacs
#+BEGIN_SRC conf :tangle ~/.emacs_zsh
  prompt walters
  unsetopt zle
  WITHIN_EMACS=true
#+END_SRC

* Terminal
Terminal emulation inside Emacs.

Disable some conflicting modes when running inside a Terminal buffer.
#+BEGIN_SRC elisp :tangle ~/.emacs.d/shells.el
  (defun custom-term-mode ()
    (interactive)
    (yas-minor-mode -1))
  
  (add-hook 'term-mode-hook 'custom-term-mode)
#+END_SRC

* Executing shell commands

| M-!         | shell-command           | Run shell command in background.                             |
| M-\vert     | shell-command-on-region | Run shell command on region in background.                   |
| C-u M-\vert | shell-command-on-region | Same as above but puts command output in the current burrer. |
